<!DOCTYPE html>
<!--
【著作権･表示】
このプログラムは「amanojaku1335」によって作成されました。
改造、商用は自由ですが、この著作権･表示は削除しないで下さい。
-->
<html>
<head>
  <meta charset="UTF-8">
  <!--
metaタグでcharsetをUTF-8に設定しています。
(モチロン他のキャラクターセットに変更しても良いですが)必ずcharsetに設定されているキャラクターセットでセーブして下さい。
-->
  <meta name="viewport" content="width=device-width">
  <style>
    .border {
      border: solid thin #000;
      border-radius: 0.35rem;
      padding: 0 0.35rem;
    }

    .image {
      width: 93vw;
      object-position: 0 0;
      object-fit: contain;
    }

  </style>
</head>
<body id="idBody" style="background: #fff;">

  Score: <span id="idQuestionScore"></span><br>
  <div id="idQuestionContainer"></div>
  <button type="button" id="idQuestionNext" style='display: none;' onclick="CreateQuestion()">Next!!</button><br>

</body>
<script>
  let a2oInterior = [
    [
      { modtype: "radio", score: 10, },
      { msgtype: "text", msg: "〇：正解、日本アルプス\n", },
      { msgtype: "text", msg: "×：不正解です\n", },
      { msgtype: "text", msg: "下記の画像の山は何ですか？\n", },
      { modtype: "image", height: 35, file: "alps001.jpg", },
      { modtype: "radio", msgtype: "text", msg: "１．日本アルプス\n", corflag: 1, },
      { modtype: "radio", msgtype: "text", msg: "２．富士山\n", },
      { modtype: "radio", msgtype: "text", msg: "３．桜島\n", },
    ],

    [
      { modtype: "radio", score: 10, },
      { msgtype: "text", msg: "〇：正解、桜島です\n", },
      { msgtype: "text", msg: "×：不正解です\n", },
      { msgtype: "text", msg: "下記から九州の火山を選んで下さい\n", },
      { modtype: "radio", msgtype: "text", msg: "１．日本アルプス\n", },
      { modtype: "radio", msgtype: "text", msg: "２．富士山\n", },
      { modtype: "radio", msgtype: "text", msg: "３．桜島\n", corflag: 1, },
    ],

    [
      { modtype: "radio", score: 10, },
      { msgtype: "text", msg: "〇：正解、富士山です\n", },
      { msgtype: "text", msg: "×：不正解です\n", },
      { msgtype: "text", msg: "下記の画像の山は何ですか？\n", },
      { modtype: "image", height: 35, file: "huji001.jpg", },
      { modtype: "radio", msgtype: "text", msg: "１．日本アルプス\n", },
      { modtype: "radio", msgtype: "text", msg: "２．富士山\n", corflag: 1, },
      { modtype: "radio", msgtype: "text", msg: "３．桜島\n", },
    ],

    [
      { modtype: "radio", score: 10, },
      { msgtype: "text", msg: "〇：正解、1185年です\n", },
      { msgtype: "text", msg: "×：不正解です\n", },
      { msgtype: "text", msg: "鎌倉幕府成立は「いい国（1192）作ろう」ではなくなった\n", },
      { modtype: "radio", msgtype: "text", msg: "〇　", corflag: 1, },
      { modtype: "radio", msgtype: "text", msg: "×\n", },
      { msgtype: "text", msg: "〇×で答えて下さい\n", },
    ],

    [
      { modtype: "textbox", score: 10, cortype: "number", correct: 794, },
      { msgtype: "text", msg: "正解、鳴くよ(794)うぐいす平安京\n", },
      { msgtype: "text", msg: "不正解です\n", },
      { msgtype: "text", msg: "平安時代のスタートは、鳴くようぐいす平安京\n", },
      { msgtype: "text", msg: "必ず半角で数値を入力して下さい\n", },
      { modtype: "textbox", },
    ],

    [
      { modtype: "textbox", score: 10, cortype: "number", correct: 1868, },
      { msgtype: "text", msg: "正解、一つやろうや(1868)明治維新\n", },
      { msgtype: "text", msg: "不正解です\n", },
      { msgtype: "text", msg: "明治維新のスタートは、一つやろうや明治維新\n", },
      { msgtype: "text", msg: "必ず半角で数値を入力して下さい\n", },
      { modtype: "textbox", },
    ],

  ];

  let vnScreenWidth = screen.width;
  let vnScreenHeight = screen.height;

  let wQuestionContainer = document.getElementById("idQuestionContainer");
  let wQuestionNext = document.getElementById("idQuestionNext");
  let wQuestionScore = document.getElementById("idQuestionScore");

  let dhmCellar = {
    image: "<img class='image' src='@file' style='height: @heightpx;' ><br>",
    score: "<input type='hidden' name='nmScore' class='Score' value='@value'>",
    radio: "<label><input type='radio' name='nmRadioQst@serial' value='@value' onclick='QuestionRadio(this);'>@capture</label>",
    textbox: "<input type='hidden' name='nmCorrect' class='Correct' value='@correct'>" +
      "<input type='hidden' name='nmCorType' class='CorType' value='@cortype'>" +
      "<input type='text' name='nmAnswer' class='Answer' value=''> " +
      "<button type='button' onclick='QuestionText(this);'>回答</button><br>",
    question: "<div name='nmQuestion' class='Question'>@message</div>",
    correctmsg: "<div name='nmCorrectMsg' class='border CorrectMsg' style='display: none; '>@message</div>",
    incorrectmsg: "<div name='nmIncorrectMsg' class='border IncorrectMsg' style='display: none; '>@message</div>",
  };
  let a1sQstSymbol = ["correctmsg", "incorrectmsg",];
  let vmodtype, vmodel, vqnt, vinterior, value, html, vline;
  let vmsgtype, vcorflag, vmsg, vmaintype;
  let vmodmsg, vmodngmsg, vmessage, vquestion, vscore;
  let vqsttype, vcorrectmsg, vincorrectmsg, tag;
  let vcorrect, vcortype, vfile, current, wCellar, vheight;
  let vpx, vlp, vnx, vp1, vp2;
  vtotalscore = 0;
  vpx = 0;
  CreateQuestion();

  function CreateQuestion() {
    if (vpx == a2oInterior.length - 1) {
      wQuestionNext.innerHTML = "終了";
    }
    if (vpx < a2oInterior.length) {
      wQuestionNext.style.display = "none";
      if (wCellar) {
        wCellar.style.display = "none";
      }
      console.log("while (vpx < a2oInterior.length) ");
      vmaintype = a2oInterior[vpx][0]["modtype"];
      vscore = -a2oInterior[vpx][0]["score"];
      vcortype = a2oInterior[vpx][0]["cortype"];
      vcorrect = a2oInterior[vpx][0]["correct"];
      vquestion = new Array();
      for (let i = 0; i < a1sQstSymbol.length; i++) {
        vquestion[i] = a2oInterior[vpx][i + 1]["msg"];
        vquestion[i] = a2oInterior[vpx][i + 1]["msgtype"] === "html" ? vquestion[i] : Encode_HTML(vquestion[i]);
      }
      vquestion[1] = vquestion[1] ? vquestion[1] : Encode_HTML("不正解");
      // 
      wCellar = document.createElement("div");
      wCellar.name = "nmCellar";
      wQuestionContainer.appendChild(wCellar);
      vinterior = "";
      // vinterior += "<br>";
      vmodel = dhmCellar["score"];
      console.log(
        "dhmCellar[score]: " + vmodel + ", " +
        "");
      vmodel = vmodel.replace("@value", vscore);
      vinterior += vmodel;
      console.log(
        "vpx: " + vpx + ", " +
        "1:vinterior: " + vinterior + ", " +
        "vmodel: " + vmodel + ", " +
        "");

      console.log(
        "2:vinterior: " + vinterior + ", " +
        "vmodtype: " + vmodtype + ", " +
        "");
      console.log(
        "vpx: " + vpx + ", " +
        "a2oInterior: " + a2oInterior + ", " +
        "");
      console.log(
        "3:vinterior: " + vinterior + ", " +
        "");
      /*
      vmodel = dhmCellar[a1sQstSymbol[0]];
      vmodel = vmodel.replace("@message", vquestion[0]);
      vinterior += vmodel;
      */
      vp1 = 3;
      while (vp1 < a2oInterior[vpx].length) {
        vline = a2oInterior[vpx][vp1];
        vmodtype = vline["modtype"];
        vmsgtype = vline["msgtype"];
        vfile = vline["file"];
        vheight = vline["height"];
        vheight = vheight ? vheight : 50;
        vmsg = vline["msg"];
        vmsg = vmsgtype === "html" ? vmsg : Encode_HTML(vmsg);
        vcorflag = vline["corflag"];
        vcorflag = vcorflag ? vcorflag : "";
        console.log(
          "vp1: " + vp1 + ", " +
          "vline: " + vline + ", " +
          "vmodtype: " + vmodtype + ", " +
          "vmsgtype: " + vmsgtype + ", " +
          "vfile: " + vfile + ", " +
          "vmsg: " + vmsg + ", " +
          "vcorflag: " + vcorflag + ", " +
          "");
        vmodel = "";
        switch (vmodtype) {
          case "image":
            vmodel = dhmCellar[vmodtype];
            vmodel = vmodel.replace("@height", vnScreenHeight * vheight / 100);
            vmodel = vmodel.replace("@file", vfile);
            break;
          case "radio":
            vmodel = dhmCellar[vmodtype];
            vmodel = vmodel.replace("@serial", vpx);
            vmodel = vmodel.replace("@value", vcorflag);
            vmodel = vmodel.replace("@capture", vmsg);
            break;
          case "textbox":
            vmodel = dhmCellar[vmodtype];
            vmodel = vmodel.replace("@cortype", vcortype);
            vmodel = vmodel.replace("@correct", vcorrect);
            break;
          default:
            if (vmsg) {
              vmodel = vmsg;
            }
        }
        vinterior += vmodel;
        console.log(
          "vmodel: " + vmodel + ", " +
          "vinterior: " + vinterior + ", " +
          "");
        vp1++;
      }
      // vinterior += "<br>";
      for (let i = 0; i < a1sQstSymbol.length; i++) {
        vmodel = dhmCellar[a1sQstSymbol[i]];
        console.log(
          "dhmCellar[a1sQstSymbol[i]]: " + vmodel + ", " +
          "");
        vmodel = vmodel.replace("@message", vquestion[i]);
        vinterior += vmodel;
      }
      // 
      vinterior += "<br>";
      wCellar.innerHTML += vinterior;
      console.log(
        "5:vinterior: " + vinterior + ", " +
        "");
      console.log(
        "wQuestionContainer.innerHTML: " + wQuestionContainer.innerHTML + ", " +
        "");
      console.log(" ");
      vpx++;
    }
  }

  function Encode_HTML(text) {
    console.log("Encode_HTML()");
    if (text) {
      console.log(
        "text: " + text + ", " +
        "");
      text = text
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/\"/g, '&#34;')
        .replace(/\'/g, '&#39;')
        .replace(/(\x0D\x0A|\x0A|\x0D)/gs, '<br>');
      // text.replace(new RegExp('(\x0D\x0A|\x0A|\x0D)', 'gs'), '<br>');
      console.log(
        "text: " + text + ", " +
        "");
    }
    return text;
  }
  function QuestionRadio(self) {
    console.log("QuestionRadio(self)");
    wQuestionNext.style.display = ""; // "none";
    let parent = self.parentNode;
    let grandparents = parent.parentNode;
    let score = grandparents.querySelector("*[name='nmScore']");
    let correctmsg = grandparents.querySelector("*[name='nmCorrectMsg']");
    let incorrectmsg = grandparents.querySelector("*[name='nmIncorrectMsg']");
    let vscore = Math.abs(score.value);
    console.log(
      "correctmsg: " + correctmsg + ", " +
      "incorrectmsg: " + incorrectmsg + ", " +
      "");
    if (self.value) {
      correctmsg.style.display = "inline-block";
      incorrectmsg.style.display = "none";
      score.value = vscore;
    } else {
      correctmsg.style.display = "none";
      incorrectmsg.style.display = "inline-block";
      score.value = -vscore;
    }
    console.log(
      "score.value: " + score.value + ", " +
      "");
    QuestionCalcScore();
  }
  function QuestionText(self) {
    wQuestionNext.style.display = ""; // "none";
    let parent = self.parentNode;
    let grandparents = parent.parentNode;
    let score = parent.querySelector("*[name='nmScore']");
    let correctmsg = parent.querySelector("*[name='nmCorrectMsg']");
    let incorrectmsg = parent.querySelector("*[name='nmIncorrectMsg']");
    let answer = parent.querySelector("*[name='nmAnswer']");
    let correct = parent.querySelector("*[name='nmCorrect']");
    let cortype = parent.querySelector("*[name='nmCorType']");
    let vscore = Math.abs(score.value);
    let vanswer = answer.value;
    let vcorrect = correct.value;
    let vcortype = cortype.value;
    if (vcortype === "number") {
      vcorrect = Number(vcorrect);
    }
    if (vcorrect == vanswer) {
      correctmsg.style.display = "inline-block";
      incorrectmsg.style.display = "none";
      score.value = vscore;
    } else {
      correctmsg.style.display = "none";
      incorrectmsg.style.display = "inline-block";
      score.value = -vscore;
    }
    console.log(
      `vcorrect: ${vcorrect}, ` +
      `vanswer: ${vanswer}, ` +
      `score.value: ${score.value}, ` +
      "");
    QuestionCalcScore();
  }
  function QuestionCalcScore() {
    let sum = 0;
    let a1wScore = wQuestionContainer.querySelectorAll("*[name='nmScore']");
    for (wScore of a1wScore) {
      sum += Math.max(0, +wScore.value);
    }
    wQuestionScore.innerText = sum;
  }
</script>
</html>
